# Fail2ban filter for nginx 444 responses (JSON format)
# Blocks IPs that receive 444 status codes (connection closed without response)
# Compatible with JSON nginx log format

[Definition]
# Match JSON log entries with 444 status
# JSON format: {"timestamp":"...","cf_connecting_ip":"IP","status":"444",...}
# Uses cf_connecting_ip for real client IP behind CloudFlare
failregex = .*"cf_connecting_ip":"<HOST>".*"status":"444".*

# IPv4/IPv6 explicit regex (if <HOST> fails)
#failregex = .*"cf_connecting_ip":"(?P<HOST>(?:[0-9]{1,3}\.){3}[0-9]{1,3}|(?:[0-9a-fA-F]*:+)+[0-9a-fA-F]+)".*"status":"444".*

# Fallback: if cf_connecting_ip is empty, use remote_addr
#failregex = .*"(?:cf_connecting_ip":"<HOST>"|"remote_addr":"<HOST>".*"cf_connecting_ip":"").*"status":"444".*

[Init]
# Set the maximum number of lines to buffer
maxlines = 1