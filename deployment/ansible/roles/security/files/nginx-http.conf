[Definition]
# HTTP Attack Detection - Enhanced for Modern Security (JSON Format)
# Compatible with nginx JSON log format using cf_connecting_ip
# JSON format: {"timestamp":"...","cf_connecting_ip":"IP","request_method":"GET","request_uri":"/path","status":"404",...}

failregex = (?i)^.*"cf_connecting_ip":"<HOST>".*"request_uri":".*(?:wp-admin|wp-login\.php|xmlrpc\.php|phpmyadmin|pma|adminer)".*
            (?i)^.*"cf_connecting_ip":"<HOST>".*"request_uri":".*(?:etc\/passwd|etc\/shadow|proc\/self\/environ|\.git\/config|\.env|\.aws\/credentials|config\.json|secrets\.json|\.htaccess|\.htpasswd|web\.config|database\.yml)".*
            (?i)^.*"cf_connecting_ip":"<HOST>".*"request_uri":".*\.\./.*".*
            (?i)^.*"cf_connecting_ip":"<HOST>".*"request_uri":".*(?:169\.254\.169\.254|metadata\.google\.internal|metadata\.azure\.com)".*
            (?i)^.*"cf_connecting_ip":"<HOST>".*"request_uri":".*(?:<script|javascript:|vbscript:|onload=|onerror=|eval\(|alert\(|document\.cookie|window\.location)".*
            (?i)^.*"cf_connecting_ip":"<HOST>".*"request_uri":".*(?:php://|file://|ftp://|http://localhost|http://127\.0\.0\.1|jar://|netdoc:|gopher://)".*
            (?i)^.*"cf_connecting_ip":"<HOST>".*"request_uri":".*(?:\|id\||&id&|;id;|`id`|\$\(id\)|cmd=|exec=|system=|shell=|passthru=)".*
            (?i)^.*"cf_connecting_ip":"<HOST>".*"request_uri":".*(?:sqlmap|nmap|nikto|dirb|dirbuster|gobuster|wfuzz|burpsuite|acunetix|nessus|openvas)".*
            (?i)^.*"cf_connecting_ip":"<HOST>".*"request_uri":".*(?:\.well-known/security\.txt|\.git/|\.svn/|\.hg/|\.bzr/|CVS/|administrator/|manager/|phpinfo\.php|info\.php|test\.php|shell\.php|backup\.(?:sql|tar|zip))".*
            (?i)^.*"cf_connecting_ip":"<HOST>".*"args":".*(?:<script|javascript:|vbscript:|onload=|onerror=|eval\(|alert\(|document\.cookie|window\.location|\|id\||&id&|;id;|`id`|\$\(id\)|cmd=|exec=|system=|shell=|passthru=)".*
            (?i)^.*"cf_connecting_ip":"<HOST>".*"args":".*(?:union|select|insert|update|delete|drop|create|alter|exec|execute|sleep|benchmark|waitfor|\band\s+\d+\s*=\s*\d+|\bor\s+\d+\s*=\s*\d+|\d+\s*=\s*\d+|0x[0-9a-f]+|sp_|xp_|@@|information_schema)".*

ignoreregex =

[Init]
# Maximum number of lines to buffer for multiline matching
maxlines = 1
