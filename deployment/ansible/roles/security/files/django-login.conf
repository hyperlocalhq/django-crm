# Fail2ban filter for Django authentication attempts (JSON format)
# This filter detects repeated POST requests to login and signup endpoints with any language prefix
# Compatible with JSON nginx log format

[Definition]
# Match POST requests to login and signup endpoints with any 2-letter language prefix
# JSON format: {"cf_connecting_ip":"IP","request_method":"POST","request_uri":"/xx/login/","status":"4xx",...}
failregex = .*"cf_connecting_ip":"<HOST>".*"request_method":"POST".*"request_uri":"/[a-z]{2}/(?:login|signup)/?(?:\?.*?)?".*"status":"(?:4\d\d|5\d\d)".*

# Ignore successful authentication attempts (2xx status codes)
ignoreregex = .*"cf_connecting_ip":"<HOST>".*"request_method":"POST".*"request_uri":"/[a-z]{2}/(?:login|signup)/?(?:\?.*?)?".*"status":"2\d\d".*

[Init]
# Optional: Set the maximum number of lines to buffer
maxlines = 1
